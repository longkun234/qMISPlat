function CPGridRefresh(){var n=$("#CPGirdDiv").data("kendoGrid");CPGridGlobal_CurPage=n.pager!=undefined&&n.pager!=null?n.pager.page():1;n.destroy();$("#CPGirdDiv").html("");SetGridSearchCondition();InitGridAndLoadData()}function CPGridGetSelChkData(){var n="";return $.each($(".CPGridChkCss"),function(t,i){$(i).is(":checked")&&(n==""?n=$(i).val():n+="@"+$(i).val())}),n}function CPGridGetRadioSelData(){var n="";return $.each($(".CPGridRadioCss"),function(t,i){$(i).is(":checked")&&(n==""?n=$(i).val():n+="@"+$(i).val())}),n}function FormatGetDataUrl(){var t=CPWebRootPath+"/api/GridEngine/GetGridData?GridCode="+CPGridGlobal_GridCode+"&CurUserId="+CPCurUserId+"&CurUserIden="+CPCurUserIden,r,i,n;for(t+="&IsReturnRealData=true",t+="&OtherCondition="+escape(CPGridGlobal_OtherCondition),t+="&OrderBy="+escape(CPGridGlobal_OrderBy),r=CPGetQueryString(),i=0;i<r.length;i++)(n=r[i].split("="),n[0].toLowerCase()!="gridcode"&&n[0].toLowerCase()!="curuserid"&&n[0].toLowerCase()!="curuseriden"&&n[0].toLowerCase()!="isreturnrealdata"&&n[0].toLowerCase()!="currentpage"&&n[0].toLowerCase()!="othercondition"&&n[0].toLowerCase()!="orderby")&&(t+="&"+r[i]);return t}function SetHtmlShowOrHideWhenLoad(){$("#divLoading").hide();$("#CPGridSearch").show();$("#CPGridButton").show();$("#CPGirdDiv").show();CPGridGlobal_AllSearchField.length<=0?$("#CPGridSearch").hide():CPGridGlobal_AllSearchContent.length<=0&&($("#CPGridSearchTxt").attr("placeholder","可搜索"+CPGridGlobal_AllSearchFieldTip),$("#CPGridSearchTxt").attr("title","可搜索"+CPGridGlobal_AllSearchFieldTip))}function SetGridHeightAndWidth(){var n=$(window).width();n=n-$("#CPGridSearchTxt").width()-$("#CPBtnSearch").width()-48;$("#CPGridButton").width(n)}function SetGridEditTimeSelectControl(){var n=$(".layerTimeSel"),t=layui.laydate;$.each(n,function(n,i){t.render({elem:"#"+$(i).attr("id"),type:$(i).attr("data-timeFormat")})})}function InitGridFunc(){var n="";$.each(CPGridGlobal_GridObj.FuncCol,function(t,i){n+='<button type="button" id="CPGrid_FuncBtn_'+i.Id+'" class="CPGridFuncBtn_Css"><i class="icon iconfont '+i.FuncIcon+'"  ><\/i><span>'+i.FuncTitle+"<\/span><\/button>"});$("#CPGridButton").html(n);$.each(CPGridGlobal_GridObj.FuncCol,function(n,t){$("#CPGrid_FuncBtn_"+t.Id).kendoButton({click:function(){var n;if(t.FuncType==0)eval(t.FuncContext);else if(t.FuncType==1)layer.confirm("请选择是导出本页数据还是导出全部数据？",{btn:["导出本页","导出全部","取消"]},function(){var u,i,r,n,t;for(layer.close(layer.index),u=$("#CPGirdDiv").data("kendoGrid"),i="./GridView?othercondition="+escape(CPGridGlobal_OtherCondition)+"&IsExportToExcel=true&ExportToExcelPageSize="+u.pager.options.dataSource._pageSize,i+="&CurPage="+u.pager.page(),r=CPGetQueryString(),n=0;n<r.length;n++)(t=r[n].split("="),t[0].toLowerCase()!="isexporttoexcel"&&t[0].toLowerCase()!="othercondition"&&t[0].toLowerCase()!="exporttoexcelpagesize"&&t[0].toLowerCase()!="curpage")&&(i+="&"+r[n]);OpenNewModel(i,"导出Excel",200,100)},function(){var n,t;layer.close(layer.index);var u=$("#CPGirdDiv").data("kendoGrid"),r="./GridView?othercondition="+escape(CPGridGlobal_OtherCondition)+"&IsExportToExcel=true&ExportToExcelPageSize=99999999",i=CPGetQueryString();for(n=0;n<i.length;n++)(t=i[n].split("="),t[0].toLowerCase()!="isexporttoexcel"&&t[0].toLowerCase()!="othercondition"&&t[0].toLowerCase()!="exporttoexcelpagesize"&&t[0].toLowerCase()!="curpage")&&(r+="&"+i[n]);OpenNewModel(r,"导出Excel",200,100)});else if(t.FuncType!=2)if(t.FuncType==3)window.location.href=CPWebRootPath+t.FuncContext;else if(t.FuncType==4)window.open(CPWebRootPath+t.FuncContext);else if(t.FuncType==5)CPGridUpdateData();else if(t.FuncType==6)CPGridDeleteData();else if(t.FuncType==7)try{n=t.FuncContext;n=FormatUrlForOpenNewModel(n,"top","");top.OpenNewModel(n,t.FuncTitle,t.OpenWinWidth,t.OpenWinHeight)}catch(e){n=t.FuncContext;n=FormatUrlForOpenNewModel(n,"self","");OpenNewModel(n,t.FuncTitle,t.OpenWinWidth,t.OpenWinHeight)}else if(t.FuncType==8)try{n=t.FuncContext;n=FormatUrlForOpenNewModel(n,"top","CPGridRefresh()");top.OpenNewModel(n,t.FuncTitle,t.OpenWinWidth,t.OpenWinHeight)}catch(e){n=t.FuncContext;n=FormatUrlForOpenNewModel(n,"self","CPGridRefresh()");OpenNewModel(n,t.FuncTitle,t.OpenWinWidth,t.OpenWinHeight)}else if(t.FuncType==9)try{n=t.FuncContext;n=FormatUrlForOpenNewModel(n,"parent","");parent.OpenNewModel(n,t.FuncTitle,t.OpenWinWidth,t.OpenWinHeight)}catch(e){n=t.FuncContext;n=FormatUrlForOpenNewModel(n,"self","");OpenNewModel(n,t.FuncTitle,t.OpenWinWidth,t.OpenWinHeight)}else if(t.FuncType==10)try{n=t.FuncContext;n=FormatUrlForOpenNewModel(n,"parent","CPGridRefresh()");parent.OpenNewModel(n,t.FuncTitle,t.OpenWinWidth,t.OpenWinHeight)}catch(e){n=t.FuncContext;n=FormatUrlForOpenNewModel(n,"self","CPGridRefresh()");OpenNewModel(n,t.FuncTitle,t.OpenWinWidth,t.OpenWinHeight)}else t.FuncType==11?(n=t.FuncContext,n=FormatUrlForOpenNewModel(n,"self",""),OpenNewModel(n,t.FuncTitle,t.OpenWinWidth,t.OpenWinHeight)):t.FuncType==12&&(n=t.FuncContext,n=FormatUrlForOpenNewModel(n,"self","CPGridRefresh()"),OpenNewModel(n,t.FuncTitle,t.OpenWinWidth,t.OpenWinHeight))}})})}function CPGridColumnOpenLink(n){var r=$(n).attr("data-title"),i=$(n).attr("data-TargetContent"),e=$(n).attr("data-TargetType"),u=$(n).attr("data-OpenWinWidth"),f=$(n).attr("data-OpenWinHeight"),t;if(Number(e)==1)i=CPWebRootPath+i,window.location.href=i;else if(Number(e)==2)i=CPWebRootPath+i,window.open(i);else if(Number(e)==3)eval(i);else if(Number(e)==4)try{t=i;t=FormatUrlForOpenNewModel(t,"top","");top.OpenNewModel(t,r,u,f)}catch(o){t=i;t=FormatUrlForOpenNewModel(t,"self","");OpenNewModel(t,r,u,f)}else if(Number(e)==5)try{t=i;t=FormatUrlForOpenNewModel(t,"top","CPGridRefresh()");top.OpenNewModel(t,r,u,f)}catch(o){t=i;t=FormatUrlForOpenNewModel(t,"self","CPGridRefresh()");OpenNewModel(t,r,u,f)}else if(Number(e)==6)try{t=i;t=FormatUrlForOpenNewModel(t,"parent","");parent.OpenNewModel(t,r,u,f)}catch(o){t=i;t=FormatUrlForOpenNewModel(t,"self","");OpenNewModel(t,r,u,f)}else if(Number(e)==7)try{t=i;t=FormatUrlForOpenNewModel(t,"parent","CPGridRefresh()");parent.OpenNewModel(t,r,u,f)}catch(o){t=i;t=FormatUrlForOpenNewModel(t,"self","CPGridRefresh()");OpenNewModel(t,r,u,f)}else Number(e)==8?(t=i,t=FormatUrlForOpenNewModel(t,"self",""),OpenNewModel(t,r,u,f)):Number(e)==9&&(t=i,t=FormatUrlForOpenNewModel(t,"self","CPGridRefresh()"),OpenNewModel(t,r,u,f))}function CPGridGetColumnAlign(n){var t="left";return n.ShowPosition==1?t="left":n.ShowPosition==2?t="center":n.ShowPosition==3&&(t="right"),t}function CPGridFormColumnFooter(n,t){return n.IsShowSum&&(t.footerTemplate=function(){var t="";return n.SumType=="Count"?t="计数:":n.SumType=="Average"?t="平均值:":n.SumType=="Sum"?t="合计:":n.SumType=="Max"?t="最大值:":n.SumType=="Min"&&(t="最小值:"),t+n.TempSumValue},t.footerAttributes={style:"text-align:"+CPGridGetColumnAlign(n)+";"}),t}function CPGridCreateColumn(n,t){var u="CPGirdDiv",i,f,r;return CPGridGlobal_GridObj.SearchModel==1?n.IsSearchShow&&(CPGridGlobal_AllSearchField.push(n.FieldName),CPGridGlobal_AllSearchFieldTip==""?CPGridGlobal_AllSearchFieldTip=n.ColumnTitle:CPGridGlobal_AllSearchFieldTip+=","+n.ColumnTitle):CPGridGlobal_GridObj.SearchModel==2,i=null,f=n.IsShow,CPGridGlobal_IsExportToExcel=="true"&&(n.IsCanExport==!1&&(f=!1),(n.ColumnType==2||n.ColumnType==3)&&(f=!1)),f&&(r=!1,nLockIndex<=CPGridGlobal_GridObj.LockColumnCount&&(r=!0),nLockIndex++,n.IsShowSum&&(CPGrid_IsHasFooter=!0),n.ColumnType==1?i={field:"Column"+n.Id.toString(),title:n.ColumnTitle,filterable:!1,sortable:!1,locked:r,width:42,attributes:{style:"text-align: center;"},headerAttributes:{"class":"GridHeaderXH",style:"text-align: center;vertical-align:middle"}}:n.ColumnType==2?i={field:"Column"+n.Id.toString(),title:n.ColumnTitle,filterable:!1,sortable:!1,locked:r,width:40,headerTemplate:'<input  class="CPGridChkCssAll"  type="checkbox" id="'+u+'_Chk_ChkAll" style="cursor:pointer;" data-gridid="'+u+'" onclick="GridChkAllClick(this);" />',template:"<input type='checkbox'  class='CPGridChkCss'  onclick='CustomFun_OnClickKeyField(this)'  id='"+u+"_Chk_#: ColumnCPGridPK #' style='cursor:pointer;'  value='#: ColumnCPGridPK #' data-gridid='"+u+"' data-childChk='true'  />",attributes:{style:"text-align: center;"},headerAttributes:{"class":"GridHeaderXH",style:"text-align: center;vertical-align:middle"}}:n.ColumnType==3?i={field:"Column"+n.Id.toString(),title:n.ColumnTitle,filterable:!1,sortable:!1,locked:r,width:30,template:"<input type='radio'  class='CPGridRadioCss'  name='"+u+"_Radio' id='"+u+"_Radio_#: ColumnCPGridPK #' style='cursor:pointer;'  value='#: ColumnCPGridPK #' /><label for=\""+u+"_Radio_#: ColumnCPGridPK #\" style='cursor:pointer;'><\/label>",attributes:{style:"text-align: center;padding-left:8px;"},headerAttributes:{"class":"GridHeaderXH",style:"text-align: center;padding-left:8px;padding-top:5px;"}}:n.ColumnType==4?i={template:function(t){var u="",i=t["Column"+n.Id.toString()],f,r;return n.SearchShowType==3?(f=JSON.parse(CPGridGlobal_SearchListDataObj["Column"+n.Id]),$(f).each(function(n,t){if(t.valueEx==i)return i=t.textEx,!1})):i=t["Column"+n.Id.toString()],r=i,n.MaxString>0&&i.length>n.MaxString&&(i=i.substring(0,n.MaxString)+"..."),""+(u!=""?"<span "+u+"  title='"+r+"'>"+i+"<\/span>":"<span  title='"+r+"'>"+i+"<\/span>")},sortable:n.IsCanOrder,field:"Column"+n.Id.toString(),title:n.ColumnTitle,filterable:!1,locked:r,headerTemplate:'<span title="'+n.ColumnTitle+'">'+n.ColumnTitle+"<\/span>",width:n.ShowWidth*14+2,attributes:{style:"text-align:"+CPGridGetColumnAlign(n)+";"},headerAttributes:{"class":"GridHeaderNormal",style:"text-align:"+CPGridGetColumnAlign(n)+";"}}:n.ColumnType==5?i={template:function(t){var i=t["Column"+n.Id.toString()],r=i;return""+("<span  title='"+r+"'>"+i+"<\/span>")},field:"Column"+n.Id.toString(),title:n.ColumnTitle,filterable:!1,locked:r,sortable:n.IsCanOrder,headerTemplate:'<span title="'+n.ColumnTitle+'">'+n.ColumnTitle+"<\/span>",width:n.ShowWidth*14+2,attributes:{style:"text-align:"+CPGridGetColumnAlign(n)+";"},headerAttributes:{"class":"GridHeaderNormal",style:"text-align:"+CPGridGetColumnAlign(n)+";"}}:n.ColumnType==6?i={template:function(t){var i="icon-close";return n.ColumnIconOrText!=""&&(i=n.ColumnIconOrText),""+("<a href='javascript:;'  class='GridHref'  onclick='CPGridRowInnerDelete(\""+t.ColumnCPGridPK+'")\'><i class="icon iconfont '+i+"\"  style='font-size:22px;' ><\/i><\/a>")},field:"Column"+n.Id.toString(),title:n.ColumnTitle,headerTemplate:'<span title="'+n.ColumnTitle+'">'+n.ColumnTitle+"<\/span>",filterable:!1,locked:r,sortable:!1,width:n.ShowWidth*14+2,attributes:{style:"text-align:"+CPGridGetColumnAlign(n)+";"},headerAttributes:{"class":"GridHeaderNormal",style:"text-align:"+CPGridGetColumnAlign(n)+";"}}:n.ColumnType==7?i={template:function(t){return t["Column"+n.Id.toString()]},field:"Column"+n.Id.toString(),title:n.ColumnTitle,filterable:!1,locked:r,sortable:!1,headerTemplate:'<span title="'+n.ColumnTitle+'">'+n.ColumnTitle+"<\/span>",width:n.ShowWidth*14+2,attributes:{style:"text-align:"+CPGridGetColumnAlign(n)+";"},headerAttributes:{"class":"GridHeaderNormal",style:"text-align:"+CPGridGetColumnAlign(n)+";"}}:n.ColumnType==8?i={template:function(t){var i="",u=t["Column"+n.Id.toString()],r;return n.ColumnIconOrText!=""&&(u=n.ColumnIconOrText),r="",n.ColumnIconOrTextColor!=""&&(r=" color:"+n.ColumnIconOrTextColor+"; "),i+="<a href='javascript:;'  class='GridHref' ",i+=' data-title="'+t["Column"+n.Id.toString()]+'"',i+=' data-TargetContent="'+t["ColumnTargetContent"+n.Id.toString()]+'"',i+=' data-TargetType="'+n.TargetType+'"',i+=' data-OpenWinWidth="'+n.OpenWinWidth+'"',i+=' data-OpenWinHeight="'+n.OpenWinHeight+'"',i+("  onclick = 'CPGridColumnOpenLink(this)' > <i class=\"icon iconfont "+u+"\"  style='font-size:22px;"+r+"' ><\/i><\/a>")},field:"Column"+n.Id.toString(),title:n.ColumnTitle,headerTemplate:'<span title="'+n.ColumnTitle+'">'+n.ColumnTitle+"<\/span>",filterable:!1,sortable:!1,locked:r,width:n.ShowWidth*14+2,attributes:{style:"text-align:"+CPGridGetColumnAlign(n)+";"},headerAttributes:{"class":"GridHeaderNormal",style:"text-align:"+CPGridGetColumnAlign(n)+";"}}:n.ColumnType==9?i={template:function(t){var i="",r=t["Column"+n.Id.toString()],u;return n.ColumnIconOrText!=""&&(r=n.ColumnIconOrText),n.SearchShowType==3&&(u=JSON.parse(CPGridGlobal_SearchListDataObj["Column"+n.Id]),$(u).each(function(n,t){if(t.valueEx==r)return r=t.textEx,!1})),i+="<a href='javascript:;'  class='GridHref' ",i+=' data-title="'+t["Column"+n.Id.toString()]+'"',i+=' data-TargetContent="'+t["ColumnTargetContent"+n.Id.toString()]+'"',i+=' data-TargetType="'+n.TargetType+'"',i+=' data-OpenWinWidth="'+n.OpenWinWidth+'"',i+=' data-OpenWinHeight="'+n.OpenWinHeight+'"',i+(" onclick = 'CPGridColumnOpenLink(this)' > "+r+"<\/a > ")},field:"Column"+n.Id.toString(),title:n.ColumnTitle,headerTemplate:'<span title="'+n.ColumnTitle+'">'+n.ColumnTitle+"<\/span>",filterable:!1,sortable:!1,locked:r,width:n.ShowWidth*14+2,attributes:{style:"text-align:"+CPGridGetColumnAlign(n)+";"},headerAttributes:{"class":"GridHeaderNormal",style:"text-align:"+CPGridGetColumnAlign(n)+";"}}:n.ColumnType==10?i={template:function(t){var i="",r;return n.EventMethod!=null&&n.EventMethod!=""&&n.EventName!=null&&n.EventName!=""&&(i=n.EventName+='="'+n.EventMethod+'"'),r="",r+("<input type='text' id='CPGridEditControl_"+n.FieldName+"_"+t.ColumnCPGridPK.toString()+"' value=\""+t["Column"+n.Id.toString()]+"\" class='CPGridEditTextBoxCss' "+i+" />")},field:"Column"+n.Id.toString(),title:n.ColumnTitle,headerTemplate:'<span title="'+n.ColumnTitle+'">'+n.ColumnTitle+"<\/span>",filterable:!1,sortable:n.IsCanOrder,locked:r,width:n.ShowWidth*14+2,attributes:{style:"text-align:"+CPGridGetColumnAlign(n)+";"},headerAttributes:{"class":"GridHeaderNormal",style:"text-align:"+CPGridGetColumnAlign(n)+";"}}:n.ColumnType==11?i={template:function(i){var o="",f,u,s,r,e;for(n.EventMethod!=null&&n.EventMethod!=""&&n.EventName!=null&&n.EventName!=""&&(o=n.EventName+='="'+n.EventMethod+'"'),f="",f+="<select id='CPGridEditControl_"+n.FieldName+"_"+i.ColumnCPGridPK.toString()+"' class='CPGridEditListCss' "+o+">",u=JSON.parse(t["Column"+n.Id]),s=i["Column"+n.Id.toString()],r=0;r<u.length;r++)e="",s==u[r].valueEx&&(e=' selected="selected" '),f+='<option value="'+u[r].valueEx+'" '+e+">"+u[r].textEx+"<\/option>";return f+"<\/select>"},field:"Column"+n.Id.toString(),title:n.ColumnTitle,headerTemplate:'<span title="'+n.ColumnTitle+'">'+n.ColumnTitle+"<\/span>",filterable:!1,sortable:n.IsCanOrder,locked:r,width:n.ShowWidth*14+2,attributes:{style:"text-align:"+CPGridGetColumnAlign(n)+";"},headerAttributes:{"class":"GridHeaderNormal",style:"text-align:"+CPGridGetColumnAlign(n)+";"}}:n.ColumnType==12&&(i={template:function(t){var r="",i,u;return n.EventMethod!=null&&n.EventMethod!=""&&n.EventName!=null&&n.EventName!=""&&(r=n.EventName+='="'+n.EventMethod+'"'),i=CPTrim(n.TimeFormat),i==""&&(i="yyyy-MM-dd"),i=i.toLowerCase(),i=="yyyy-mm-dd"||i=="yyyy年mm月dd日"||i=="dd-mm-yy"||i=="yy-mm-dd"?i="date":i=="mm月dd日"?i="date":i=="yyyy年mm月"||i=="mm-yy"?i="month":i=="yyyy年mm月dd日  hh:mm"||i=="yyyy年mm月dd日  hh:mm:ss"||i=="yyyy-mm-dd hh:mm"||i=="yyyy-mm-dd hh:mm:ss"?i="datetime":(i=="hh:mm"||i=="hh:mm:ss")&&(i="time"),u="",u+("<input type='text' id='CPGridEditControl_"+n.FieldName+"_"+t.ColumnCPGridPK.toString()+"' value=\""+t["Column"+n.Id.toString()]+"\" class='layerTimeSel CPGridEditTextBoxCss' "+r+' data-timeFormat="'+i+'" />')},field:"Column"+n.Id.toString(),title:n.ColumnTitle,headerTemplate:'<span title="'+n.ColumnTitle+'">'+n.ColumnTitle+"<\/span>",filterable:!1,locked:r,sortable:n.IsCanOrder,width:n.ShowWidth*14+2,attributes:{style:"text-align:"+CPGridGetColumnAlign(n)+";"},headerAttributes:{"class":"GridHeaderNormal",style:"text-align:"+CPGridGetColumnAlign(n)+";"}}),i=CPGridFormColumnFooter(n,i)),i}function GetGridColumnByColumnId(n){var t;return $.each(CPGridGlobal_GridObj.ColumnCol,function(i,r){if(Number(n)==Number(r.Id)){t=r;return}}),t}function CPGridCreateQueryColumn(n){$.each(CPGridGlobal_GridObj.SearchColumnCol,function(t,i){var o,u,r,e,f;if(i.IsSearchShow){CPGridGlobal_AllSearchField.push(i.FieldName);o="<label style='padding-right:5px'>"+i.ColumnTitle+"<\/label>";u="";switch(i.SearchShowType){case 1:u="<input type='text' id='CPGridQueryControl_"+i.FieldName+"' class='SearchArrayTextBoxCss'/>";break;case 2:r=CPTrim(i.TimeFormat);r==""&&(r="yyyy-MM-dd");r=r.toLowerCase();r=="yyyy-mm-dd"||r=="yyyy年mm月dd日"||r=="dd-mm-yy"||r=="yy-mm-dd"?r="date":r=="mm月dd日"?r="date":r=="yyyy年mm月"||r=="mm-yy"?r="month":r=="yyyy年mm月dd日  hh:mm"||r=="yyyy年mm月dd日  hh:mm:ss"||r=="yyyy-mm-dd hh:mm"||r=="yyyy-mm-dd hh:mm:ss"?r="datetime":(r=="hh:mm"||r=="hh:mm:ss")&&(r="time");u+="<span class='SearchCPGridDateTextBoxSearchModeCss'>";u+="<select id='SearchMode_"+i.FieldName+'\' style="width:60px" onchange=\'changeSearchMode("'+i.FieldName+'","'+r+"\")'>";u+="<option value='1'>等于<\/option>";u+="<option value='2'>大于<\/option>";u+="<option value='3'>小于<\/option>";u+="<option value='4'>大于等于<\/option>";u+="<option value='5'>小于等于<\/option>";u+="<option value='6'>区间<\/option>";u+="<\/select><\/span>";u+="<span id='CPGridSpan_"+i.FieldName+"'>";u+="<input type='text' id='CPGridQueryControl_"+i.FieldName+"'class='layerTimeSel SearchCPGridEditTextBoxCss' data-timeFormat=\""+r+'" />';u+="<label class='SearchDefaultDateMode'>至<\/label>";u+="<input type='text' id='CPGridQueryControl_"+i.FieldName+"_2'class='layerTimeSel SearchCPGridEditTextBoxCss SearchDefaultDateMode' data-timeFormat=\""+r+'" />';u+="<\/span >";break;case 3:for(u+="<select id='CPGridQueryControl_"+i.FieldName+"' class='SearchCPGridEditListCss' >",e=JSON.parse(n["Column"+i.Id]),u+='<option value="0">请选择<\/option>',f=0;f<e.length;f++)u+='<option value="'+e[f].valueEx+'">'+e[f].textEx+"<\/option>";u+="<\/select>"}CPGridGlobal_AllSearchContent+="<span class='SearchCPGridSpanCss'>"+o+u+"<\/span>"}})}function changeSearchMode(n){var t=$("#SearchMode_"+n);if(t.val()!="6"){$(".SearchBlockDateMode").hasClass("SearchBlockDateMode")&&$(".SearchBlockDateMode").addClass("SearchDefaultDateMode");$(".SearchBlockDateMode").removeClass("SearchBlockDateMode");return}$(".SearchDefaultDateMode").hasClass("SearchDefaultDateMode")&&$(".SearchDefaultDateMode").addClass("SearchBlockDateMode");$(".SearchDefaultDateMode").removeClass("SearchDefaultDateMode")}function InitGridAndLoadData(){var r=CPWebRootPath+"/api/GridEngine/GetGridInfo?GridCode="+CPGridGlobal_GridCode+"&CurUserId="+CPCurUserId+"&CurUserIden="+CPCurUserIden,i,n,t,u;for(r+="&OtherCondition="+escape(CPGridGlobal_OtherCondition),i=CPGetQueryString(),n=0;n<i.length;n++)(t=i[n].split("="),t[0].toLowerCase()!="gridcode"&&t[0].toLowerCase()!="curuserid"&&t[0].toLowerCase()!="curuseriden"&&t[0].toLowerCase()!="othercondition")&&(r+="&"+i[n]);u=FormatGetDataUrl();$.getJSON(r,function(n){var s,i,c,r,o,h,t,f,e;if(console.log(n),CPGridGlobal_GridObj=n.Grid,n.Result==!1)return alert(n.ErrorMsg),!1;$(document).attr("title",CPGridGlobal_GridObj.GridTitle);InitGridFunc();s="CPGirdDiv";i=null;n.ListDataJson!=null&&n.ListDataJson!=""&&(i=JSON.parse(n.ListDataJson));c=null;n.SearchListDataJson!=null&&n.SearchListDataJson!=""&&(CPGridGlobal_SearchListDataObj=JSON.parse(n.SearchListDataJson));r=[];CPGridGlobal_AllSearchField.splice(0,CPGridGlobal_AllSearchField.length);CPGridGlobal_AllSearchFieldTip="";nLockIndex=1;$.each(n.Grid.HeaderGroup,function(n,t){if(t.GroupTitle=="")$.each(t.ChildColumnId,function(n,t){var u=CPGridCreateColumn(GetGridColumnByColumnId(t),i);u!=null&&r.push(u)});else{var u={};u.title=t.GroupTitle;u.columns=[];u.headerAttributes={"class":"GridHeaderXH",style:"text-align: center;vertical-align:middle"};$.each(t.ChildGroupCol,function(n,t){if(t.GroupTitle=="")$.each(t.ChildColumnId,function(n,t){var r=CPGridCreateColumn(GetGridColumnByColumnId(t),i);r!=null&&u.columns.push(r)});else{var r={};r.title=t.GroupTitle;r.columns=[];r.headerAttributes={"class":"GridHeaderXH",style:"text-align: center;vertical-align:middle"};$.each(t.ChildColumnId,function(n,t){var u=CPGridCreateColumn(GetGridColumnByColumnId(t),i);u!=null&&r.columns.push(u)});t.ChildColumnId.length>0&&u.columns.push(r)}});t.ChildGroupCol.length>0&&r.push(u)}});n.Grid.SearchModel==2&&(CPGridCreateQueryColumn(CPGridGlobal_SearchListDataObj),$(CPGridGlobal_AllSearchContent).replaceAll($("#CPGridSearchTxt")));o=[];n.Grid.IsGroup&&n.Grid.GroupField!=""&&(h=n.Grid.GroupField.split(","),$.each(h,function(t,i){i=CPTrim(i);i!=""&&(o.push({field:i+"_CPGroup",title:n.Grid.GroupAlias}),r.push({field:i+"_CPGroup",title:n.Grid.GroupAlias,filterable:!1,hidden:!0,width:16,attributes:{style:""},headerAttributes:{"class":"GridHeaderNormal"}}))}));t=$(window).height()-$("#CPGridSearch").height()-20;n.Grid.SearchModel==2&&(t=t-$("#CPGridButton").height());CPGrid_IsHasFooter&&(t=t-32);f={refresh:!1,pageSizes:!0};e=n.Grid.PageSize;n.Grid.IsPage==!1&&(f=!1,e=9999999);CPGridGlobal_IsExportToExcel=="true"&&(f=!1,e=Number(CPGridGlobal_ExportToExcelPageSize));$("#"+s).kendoGrid({dataSource:{type:"json",transport:{read:u},schema:{data:function(n){return n.Result==!1?(alert(n.ErrorMsg),!1):jQuery.parseJSON(n.DataJson)},total:function(n){return n.RecordSize}},requestStart:function(){n.Grid.LockColumnCount<=0&&$("#CPGirdDiv").hide()},requestEnd:function(n){var t=n.response,i=n.type},page:CPGridGlobal_CurPage,pageSize:e,serverPaging:!0,serverFiltering:!0,serverSorting:!0,group:o},excel:{fileName:n.Grid.GridTitle+".xlsx"},width:"800px",height:t,filterable:!1,sortable:!0,pageable:f,allowCopy:!0,groupable:n.Grid.IsShowGroupArea,scrollable:!0,selectable:"row",resizable:!0,navigatable:!1,columns:r,change:function(){var t,i,n,r;if(event.button==0)for(t=this.select(),i=[],n=0;n<t.length;n++)r=this.dataItem(t[n]),$.inArray(r.ColumnCPGridPK,i)==-1&&i.push(r.ColumnCPGridPK)},excelExport:function(){parent.CloseNewModel()},dataBound:function(){if(CPGridGlobal_IsExportToExcel=="true"){var n=$("#CPGirdDiv").data("kendoGrid");n.saveAsExcel()}else SetHtmlShowOrHideWhenLoad(),SetGridHeightAndWidth(),SetGridEditTimeSelectControl();CPGridGlobal_GridObj.JsEx!=null&&CPGridGlobal_GridObj.JsEx!=""&&$("#divCPGridJSContainer").html(CPGridGlobal_GridObj.JsEx)},navigate:function(n){var t=n.sender,i=t.dataItem($(n.element).parent());event.button==2}})})}function SearchTextOnClick(n){$(n).attr("placeholder","");event.keyCode==13&&CPGridSearch()}function SetGridSearchCondition(){function t(){var i=new Date,r="-",u=i.getFullYear(),n=i.getMonth()+1,t=i.getDate();return n>=1&&n<=9&&(n="0"+n),t>=0&&t<=9&&(t="0"+t),u+r+n+r+t}CPGridGlobal_OtherCondition="";var n=CPTrim($("#CPGridSearchTxt").val());$("#CPGridSearchTxt").length>0&&n==""||$.each(CPGridGlobal_AllSearchField,function(i,r){var f=" OR ",e,u;if($("#CPGridSearchTxt").length==0&&(n=$("#CPGridQueryControl_"+r).val(),f=" AND "),$("#CPGridQueryControl_"+r).get(0).tagName=="SELECT"&&n=="0")return!0;if($("#CPGridQueryControl_"+r).get(0).tagName=="INPUT"&&$("#CPGridQueryControl_"+r).get(0).hasAttribute("data-timeformat")){e=$("#SearchMode_"+r);n=$("#CPGridQueryControl_"+r).val();switch(e.val()){case"1":n!=""&&(n=" ("+r+" = '"+n+"') ");break;case"2":n!=""&&(n=" ("+r+" > '"+n+"') ");break;case"3":n!=""&&(n=" ("+r+" < '"+n+"') ");break;case"4":n!=""&&(n=" ("+r+" >= '"+n+"') ");break;case"5":n!=""&&(n=" ("+r+" <= '"+n+"') ");break;case"6":if(u=$("#CPGridQueryControl_"+r+"_2").val(),u=="")if(n!="")u=t();else return;n==""&&(n="1999-01-01");n=r+"  between ' "+n+" ' and  '"+u+"'"}if(n=="")return!0}else{if(n=="")return!0;n=" ("+r+" like '@"+n+"@') "}CPGridGlobal_OtherCondition==""?CPGridGlobal_OtherCondition=n:CPGridGlobal_OtherCondition+=f+n})}function CPGridSearch(){var n=$("#CPGirdDiv").data("kendoGrid");n.destroy();$("#CPGirdDiv").html("");SetGridSearchCondition();CPGridGlobal_CurPage=1;InitGridAndLoadData()}function GridChkAllClick(n){$(n).is(":checked")?$.each($(".CPGridChkCss"),function(n,t){document.getElementById($(t).attr("id")).checked="checked"}):$.each($(".CPGridChkCss"),function(n,t){document.getElementById($(t).attr("id")).checked=""})}function GridChkItemClick(){}function CPGridGetSelDataWhenUpdate(){var n=[];return $.each($(".CPGridChkCss"),function(t,i){if($(i).is(":checked")){var r={};r.DataPK=$(i).val();r.FieldNamCol=[];r.FieldValueCol=[];$.each(CPGridGlobal_GridObj.ColumnCol,function(n,t){(t.ColumnType==10||t.ColumnType==11||t.ColumnType==12)&&(r.FieldNamCol.push(t.FieldName),r.FieldValueCol.push($("#CPGridEditControl_"+t.FieldName+"_"+r.DataPK).val()))});n.push(r)}}),n}function CPGridUpdateData(){var n={},t;if(n.Items=CPGridGetSelDataWhenUpdate(),n.Items.length<=0)return alert("请选择要修改的数据！"),!1;n.GridCode=CPGridGlobal_GridObj.GridCode;n.CurUserId=CPCurUserId;n.CurUserIden=CPCurUserIden;t=CPWebRootPath+"/api/GridEngine/UpdateGridData";$.ajax({type:"POST",url:t,data:JSON.stringify(n),contentType:"application/json",success:function(n){if(n.Result==!1)return alert("修改失败，详细信息："+n.ErrorMsg),!1;alert("修改成功！");CPGridRefresh()}})}function CPGridRowInnerDelete(n){var r,u,t,i;if(confirm("确实要删除选中的数据吗？")){for(r=CPWebRootPath+"/api/GridEngine/DeleteGridData?GridCode="+CPGridGlobal_GridCode+"&CurUserId="+CPCurUserId+"&CurUserIden="+CPCurUserIden,r+="&DataPks="+n,u=CPGetQueryString(),t=0;t<u.length;t++)(i=u[t].split("="),i[0].toLowerCase()!="gridcode"&&i[0].toLowerCase()!="curuserid"&&i[0].toLowerCase()!="curuseriden"&&i[0].toLowerCase()!="datapks")&&(r+="&"+u[t]);$.getJSON(r,function(n){if(n.Result==!1)return alert("删除失败，详细信息："+n.ErrorMsg),!1;alert("删除成功！");CPGridRefresh()})}}function CPGridDeleteData(){var u=CPGridGetSelChkData(),i,r,n,t;if(u=="")return alert("请选择要删除的数据！"),!1;if(confirm("确实要删除选中的数据吗？")){for(i=CPWebRootPath+"/api/GridEngine/DeleteGridData?GridCode="+CPGridGlobal_GridCode+"&CurUserId="+CPCurUserId+"&CurUserIden="+CPCurUserIden,i+="&DataPks="+u,r=CPGetQueryString(),n=0;n<r.length;n++)(t=r[n].split("="),t[0].toLowerCase()!="gridcode"&&t[0].toLowerCase()!="curuserid"&&t[0].toLowerCase()!="curuseriden"&&t[0].toLowerCase()!="datapks")&&(i+="&"+r[n]);$.getJSON(i,function(n){if(n.Result==!1)return alert("删除失败，详细信息："+n.ErrorMsg),!1;alert("删除成功！");CPGridRefresh()})}}function SelectExpression_SetReturn(){var t=$(SelectExpression_ThisObj),n=$(t).val();n=n.replace("{}",CPShowModalDialogReturnArgs);$(t).val(n)}function SelectExpression(n,t){var u=$(n).val();if(u.indexOf("{}")!=-1){SelectExpression_ThisObj=n;var f=CPWebRootPath+"/Plat/Common/SelectExp?Type="+t,i=600,r=750,e=(window.screen.availHeight-30-i)/2,o=(window.screen.availWidth-10-r)/2,s="新窗口_"+Math.random();window.open(f,"","height="+i+", width="+r+",top="+e+",left="+o+", location=yes,menubar=no,resizable=yes,scrollbars=yes,status=no,toolbar=no");return}}function CPGridUpdateConfig(n){var t="/Plat/Tab/TabView?TabCode=Tab0001&DeviceType=1&SysId=1&TargetGridId="+n;try{top.OpenNewModel(t,"修改配置",9e3,9e3)}catch(i){OpenNewModel(t,"修改配置",9e3,9e3)}}var CPGridGlobal_GridCode=$.CPGetQuery("GridCode"),CPGridGlobal_IsExportToExcel,CPGridGlobal_ExportToExcelPageSize,CPGridGlobal_DeviceType,CPGridGlobal_OtherCondition,CPGridGlobal_CurPage,nLockIndex,CPGrid_IsHasFooter,SelectExpression_ThisObj;(CPGridGlobal_GridCode==null||CPGridGlobal_GridCode==undefined)&&(CPGridGlobal_GridCode="");CPGridGlobal_IsExportToExcel=$.CPGetQuery("IsExportToExcel");(CPGridGlobal_IsExportToExcel==null||CPGridGlobal_IsExportToExcel==undefined)&&(CPGridGlobal_IsExportToExcel="false");CPGridGlobal_ExportToExcelPageSize=$.CPGetQuery("ExportToExcelPageSize");(CPGridGlobal_ExportToExcelPageSize==null||CPGridGlobal_ExportToExcelPageSize==undefined)&&(CPGridGlobal_ExportToExcelPageSize="20");CPGridGlobal_DeviceType=$.CPGetQuery("DeviceType");(CPGridGlobal_DeviceType==null||CPGridGlobal_DeviceType==undefined)&&(CPGridGlobal_DeviceType="1");CPGridGlobal_OtherCondition=$.CPGetQuery("OtherCondition");(CPGridGlobal_OtherCondition==null||CPGridGlobal_OtherCondition==undefined)&&(CPGridGlobal_OtherCondition="");CPGridGlobal_CurPage=$.CPGetQuery("CurPage");(CPGridGlobal_CurPage==null||CPGridGlobal_CurPage==undefined)&&(CPGridGlobal_CurPage=1);var CPGridGlobal_GridObj=null,CPGridGlobal_AllSearchField=[],CPGridGlobal_AllSearchFieldTip="",CPGridGlobal_SearchListDataObj=[],CPGridGlobal_OrderBy="",CPGridGlobal_AllSearchContent="";nLockIndex=1;CPGrid_IsHasFooter=!1;layui.use("laydate",function(){});$(function(){$("#CPBtnSearch").kendoButton({imageUrl:"../../Style/CommonIcon/search.png",click:function(){CPGridSearch()}});InitGridAndLoadData()});CustomFun_OnClickKeyField=function(){return!0};CustomFun_MergeGridRows=function(n,t){$("#"+n+">.k-grid-content>table").each(function(i,r){var u=1;$("#"+n+">.k-grid-header>.k-grid-header-wrap>table").find("th").each(function(){if($(this).text()==t){var n=null;$(r).find("tr").each(function(){var t=$(this).find("td:nth-child("+u+")");n==null?n=t:t.text()==n.text()?(t.remove(),n.attr("rowspan",typeof n.attr("rowspan")=="undefined"?2:Number(n.attr("rowspan"))+1)):n=t});return}u++})})};CustomFun_MergeGridRowsForMulCol=function(n,t,i){$("#"+n+">.k-grid-content>table").each(function(r,u){var f=1;$("#"+n+">.k-grid-header>.k-grid-header-wrap>table").find("th").each(function(){if($(this).text()==t){var n=null;$(u).find("tr").each(function(){var t=$(this).find("td:nth-child("+f+")"),r=$(this),u;n==null?(n=t,$(i).each(function(n,t){t.CurObj=r.find("td:nth-child("+t.index+")")})):t.text()==n.text()?(u=[],$(i).each(function(n,t){u.push(r.find("td:nth-child("+t.index+")"))}),$(u).each(function(n,t){t.remove()}),t.remove(),n.attr("rowspan",typeof n.attr("rowspan")=="undefined"?2:Number(n.attr("rowspan"))+1),$(i).each(function(n,t){t.CurObj.attr("rowspan",typeof t.CurObj.attr("rowspan")=="undefined"?2:Number(t.CurObj.attr("rowspan"))+1)})):(n=t,$(i).each(function(n,t){t.CurObj=r.find("td:nth-child("+t.index+")")}))});return}f++})})};